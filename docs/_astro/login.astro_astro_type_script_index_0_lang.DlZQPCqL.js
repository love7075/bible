const i=document.getElementById("loginForm"),s=document.getElementById("errorMessage");function a(t){s&&(s.textContent=t,s.classList.remove("hidden"))}i?.addEventListener("submit",async t=>{t.preventDefault();const c=new FormData(i),n=c.get("username"),r=c.get("password");if(console.log("提交的登录信息:",{username:n,password:r}),!n||!r){a("用户名和密码不能为空");return}try{const e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:r})}),o=await e.json();console.log("服务器响应:",o),e.ok?(localStorage.setItem("token",o.token),localStorage.setItem("user",JSON.stringify(o.user)),window.location.href="/"):a(o.error||"登录失败")}catch(e){console.error("登录错误:",e),a("登录失败，请稍后重试")}});
